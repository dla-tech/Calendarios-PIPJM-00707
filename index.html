<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="robots" content="noindex, nofollow">
<title>Programaciones mensuales</title>
<style>
  /* Loader */
  /* Bloquea scroll durante el loader y asegura altura completa */
  .loading html { height: 100%; }
  .loading,
  .loading body {
    overflow: hidden;
    height: 100%;
  }
  #loader {
    position: fixed;
    inset: 0;
    background: linear-gradient(180deg, #1a0a00 0%, #3b0f00 20%, #7a1b00 45%, #c74300 70%, #ff9a00 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 1s ease;
    height: 100dvh;
    min-height: 100vh;       /* fallback clásico */
    width: 100vw;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    pointer-events: all;
    padding-bottom: env(safe-area-inset-bottom);
  }
  @supports (height: 100svh) {
    #loader { height: 100svh; }
  }
  @supports (height: 100lvh) {
    #loader { height: 100lvh; }
  }
  #loader .explosion {
    position: absolute;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    width: 100%;
    height: 100%;
  }
  #loader .logo {
    width: 320px;
    animation: pulse 1.5s infinite;
    position: relative;
    z-index: 10; /* encima */
  }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }
  #loader.hidden {
    opacity: 0;
    pointer-events: none;
  }
  :root{
    --bg:url("https://raw.githubusercontent.com/dla-tech/Media-privada/refs/heads/main/2025-04-13-17-10-05-878.jpeg");
    --card: rgba(255,255,255,.86);
    --ink: #0b1421;
    --accent: #2563eb;
    --shadow: 0 8px 20px rgba(0,0,0,.15);
    --radius: 14px;
  }
  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{
    margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:var(--ink);
    background:#0b1421; min-height:100svh;
  }
  body::before{content:"";position:fixed;inset:0;background-image:var(--bg);background-size:cover;background-position:center;filter:brightness(.9) saturate(.9);z-index:-2}
  body::after{content:"";position:fixed;inset:0;background:linear-gradient(180deg,rgba(8,11,20,.35),rgba(8,11,20,.6));z-index:-1}

  /* ===== NAV responsive y ordenado ===== */
  header{
    position:sticky; top:0; z-index:50;
    backdrop-filter:saturate(1.2) blur(8px);
    background:rgba(255,255,255,.55);
    border-bottom:1px solid rgba(0,0,0,.08);
  }
  /* Auto-ocultar barra en scroll */
  header{ transition: transform .4s ease; will-change: transform; }
  header.hide{ transform: translateY(-100%); }

  /* MÓVIL: grilla de botones iguales */
  .nav{
    max-width:1100px; margin:0 auto; padding:8px 10px;
    display:grid; gap:8px;
    grid-template-columns: repeat(2, 1fr); /* 2 columnas en móvil */
  }
  .nav .spacer{ display:none; } /* no hace falta en móvil */
  .nav a{
    display:block;
    text-align:center;
    text-decoration:none;
    font-weight:600;
    color:#0b1421;
    padding:10px 10px;
    font-size:14px;
    border-radius:10px;
    border:1px solid rgba(0,0,0,.08);
    background:rgba(255,255,255,.5);
  }
  .nav a.active{
    background:#e9efff;
    color:#2563eb;
    border-color:rgba(37,99,235,.25);
  }

  /* iOS compacto: mantén 2 columnas pero reduce tamaño visual */
  @supports (-webkit-touch-callout: none){
    @media (max-width: 430px){
      .nav{ padding:8px 10px; gap:8px; }
      .nav a{ padding:9px 10px; font-size:13.5px; border-radius:10px; }
    }
    @media (max-width: 360px){
      .nav{ padding:6px 8px; gap:6px; }
      .nav a{ padding:8px 8px; font-size:13px; }
    }
  }

  /* TABLET+: vuelve a barra horizontal */
  @media (min-width: 768px){
    .nav{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      padding:10px 16px;
    }
    .nav .spacer{ flex:1; display:block; }
    .nav a{
      padding:10px 12px;
      min-width:auto;
      background:transparent;
      border:0;
    }
    .nav a.active{
      background:#e9efff;
      border:0;
    }
  }
  .wrap{max-width:1100px; margin:0 auto; padding:22px 16px}

  .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:14px}
  h1,h2{color:#fff; text-align:center; margin:10px 0 14px}
  section{scroll-margin-top:80px; margin-bottom:22px}
  iframe{border:0; width:100%; border-radius:10px}
  .grid{display:grid; gap:12px}
  @media(min-width:720px){
    .grid.cols-2{grid-template-columns:1fr 1fr}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
  }
  .grid.cols-1{grid-template-columns:1fr}
  .subhead{margin:0 0 6px; font-weight:700; color:#0b1421}

  .btn{display:block; text-align:center; text-decoration:none; padding:14px 16px;
       border-radius:12px; font-weight:700; color:#fff}
  .btn-g{background:#4285F4}
  .btn-i{background:#34C759}
  .btn-d{background:#0f172a}

  /* Live YouTube styles */
  .live-wrap { display:none; margin-top:10px; border-radius:12px; overflow:hidden; box-shadow:0 6px 16px rgba(0,0,0,.2); background:#000 }
  .live-head { display:flex; align-items:center; gap:8px; padding:10px 12px; color:#fff; font-weight:800; letter-spacing:.2px; background:linear-gradient(90deg,#b91c1c,#ef4444) }
  .live-dot { width:10px; height:10px; border-radius:999px; background:#fff; box-shadow:0 0 8px rgba(255,255,255,.9) }
  .live-player { position:relative; aspect-ratio:16/9; background:#000 }
  .live-player iframe { position:absolute; inset:0; width:100%; height:100%; border:0 }
  .live-cta { display:block; padding:10px 12px; text-align:center; text-decoration:none; color:#fff; font-weight:700; background:#111 }

  .note{font-size:.92em; opacity:.8}
  .list{margin:0; padding-left:18px}
  .footer{color:#e5e7eb; text-align:center; font-size:.9em; padding:26px 0}

  /* Modal contacto */
  .contact-modal {
    display:none; position:fixed; inset:0;
    background:rgba(0,0,0,0.6);
    align-items:center; justify-content:center;
    z-index:10000;
  }
  .contact-modal .modal-content {
    background:#fff; padding:20px; border-radius:12px;
    text-align:center; max-width:300px; width:90%;
    box-shadow:0 6px 16px rgba(0,0,0,.25);
  }
  .contact-modal .btn {
    display:block; margin:10px 0; text-decoration:none;
    padding:12px; border-radius:8px; color:#fff; font-weight:600;
  }
  .contact-modal .btn-d {
    display:block;
    margin:10px 0;
    padding:12px;
    border-radius:8px;
    color:#fff;
    font-weight:600;
    background:#444;
    border:none;
    width:100%;
    text-align:center;
  }
</style>
</head>
<body>

  <!-- Pantalla de carga -->
  <div id="loader">
    <canvas class="explosion" id="explosion-canvas"></canvas>
    <img class="logo" src="https://raw.githubusercontent.com/dla-tech/Media-privada/refs/heads/main/Untitled%20design.png.png" alt="Logo" />
  </div>

<header>
  <nav class="nav">
    <div class="spacer"></div>
    <a href="#calendarios" class="navlink">Calendarios</a>
    <a href="#redes" class="navlink">Redes sociales</a>
    <a href="#ubicacion-templo" class="navlink">Ubicación del templo</a>
    <a href="#ubicacion-cultos" class="navlink">Ubicación de los cultos</a>
    <a href="#proposito" class="navlink">Propósito</a>
  </nav>
</header>

<main class="wrap">

  <!-- CALENDARIOS -->
  <section id="calendarios">
    <h1 style="font-size:1.35em; line-height:1.25; font-weight:700;">
      Primera Iglesia Pentecostal de Jesucristo de Maunabo, P.R. Inc.
    </h1>
    <div class="card" style="margin-bottom:12px">
      <iframe
        src="https://calendar.google.com/calendar/embed?src=72086005a3ac9a324642e6977fb8f296d531c3520b03c6cf342495ed215e0186%40group.calendar.google.com&ctz=America%2FPuerto_Rico&bgcolor=%23f4f7fb&hl=en"
        title="Calendario Google" loading="lazy" referrerpolicy="no-referrer-when-downgrade" height="600">
      </iframe>
    </div>

    <div class="grid cols-2">
      <a id="btn-gcal" class="btn btn-g" href="#" target="_blank" rel="noopener">🟢 Añadir en Google Calendar (Android/PC)</a>
      <a id="btn-ios" class="btn btn-i" href="#" target="_self">📱 Añadir en Apple Calendar (iPhone/Mac)</a>
    </div>

    <p class="card note" style="margin-top:12px">
      📌 Todo cambio en la programación de la iglesia se reflejará automáticamente en tu calendario.
    </p>
  </section>

  <!-- REDES SOCIALES -->
  <section id="redes">
    <h2>Redes sociales</h2>
    <div class="card">
      <div class="grid cols-1">
        <a class="btn btn-g" href="https://youtube.com/@pipjm9752?si=r3nrs4hxzxk-OVmI" target="_blank" rel="noopener">▶️ YouTube</a>
        <!-- LIVE (auto) -->
        <div id="live-wrap" class="live-wrap">
          <div class="live-head"><span class="live-dot"></span> EN VIVO AHORA</div>
          <div class="live-player" id="live-player"></div>
          <a id="live-cta" class="live-cta" href="https://www.youtube.com/@pipjm9752/live" target="_blank" rel="noopener">Ver en YouTube</a>
        </div>
        <a class="btn btn-d" href="mailto:pipjm1@gmail.com">✉️ pipjm1@gmail.com</a>
      </div>
    </div>
  </section>

  <!-- UBICACIÓN TEMPLO -->
  <section id="ubicacion-templo">
    <h2>Ubicación del templo</h2>
    <div class="card">
      <p><strong>Dirección:</strong> <a href="https://maps.app.goo.gl/4R9ZXAmw1ZcnBTL49?g_st=ipc" target="_blank" rel="noopener">Ver en Google Maps</a></p>
      <a href="https://maps.app.goo.gl/4R9ZXAmw1ZcnBTL49?g_st=ipc" target="_blank" rel="noopener">
        <img src="https://raw.githubusercontent.com/dla-tech/Media-privada/refs/heads/main/2025-04-13-17-10-05-878.jpeg" alt="Ubicación del templo" style="width:100%; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,.25)">
      </a>
    </div>
  </section>

  <!-- UBICACIÓN CULTOS -->
  <section id="ubicacion-cultos">
    <h2>Ubicación de cultos evangelísticos</h2>
    <div class="card">
      <p>Algunos servicios se realizan en ubicaciones distintas:</p>
      <div class="grid cols-2">
        <div>
          <p class="subhead"><span id="lbl-martes">Martes</span></p>
          <p><strong id="title-martes">Culto evangelístico</strong><br><span id="addr-martes">(TODO: dirección)</span></p>
          <iframe src="https://www.google.com/maps?q=Maunabo%20Puerto%20Rico&output=embed"
                  height="260" loading="lazy" title="Culto martes"></iframe>
        </div>
        <div>
          <p class="subhead"><span id="lbl-miercoles">Miércoles</span></p>
          <p><strong id="title-miercoles">Culto evangelístico</strong><br><span id="addr-miercoles">(TODO: dirección)</span></p>
          <iframe src="https://www.google.com/maps?q=Maunabo%20Puerto%20Rico&output=embed"
                  height="260" loading="lazy" title="Culto miércoles"></iframe>
        </div>
      </div>
    </div>
  </section>

  <!-- PROPOSITO -->
  <section id="proposito">
    <h2>Propósito</h2>
    <div class="card">
      <p><strong>Nuestro propósito</strong> es: “Llevar el evangelio a toda criatura, dar un mensaje de esperanza, mostrar el amor de Dios al mundo y ayudar al necesitado.”</p>
      <h3 style="margin-top:16px; font-size:1.1em; color:#0b1421;">Horarios de cultos y actividades</h3>
      <ul class="list">
        <li><strong>Lunes:</strong> Culto de oración en el templo — 7:00 p.m.</li>
        <li><strong>Martes y Miércoles:</strong> Cultos evangelísticos en Maunabo y lugares limítrofes — 7:00 p.m.</li>
        <li><strong>Jueves:</strong> Culto de la Sociedad de Niños, oración o estudio bíblico — 7:00 p.m.</li>
        <li><strong>Viernes:</strong> Culto de las Sociedades de Damas, Caballeros y Jóvenes — 7:00 p.m.</li>
        <li><strong>Sábado:</strong> Altar familiar. (Una vez al mes, ayuno congregacional) — 6:00 a.m.</li>
        <li><strong>Domingo:</strong>
          <ul>
            <li>Oración/Ayuno — desde las 6:00 a.m.</li>
            <li>Apertura de Escuela Bíblica — 8:45 a.m.</li>
            <li>Cierre de Escuela Bíblica — 10:45 a.m.</li>
            <li>Comienzo del culto de adoración — 11:15 a.m.</li>
          </ul>
        </li>
      </ul>
    </div>
  </section>

  <!-- CONTACTO -->
  <div class="footer">© 2025 — Iglesia. Todos los derechos reservados.</div>
</main>

<!-- =========================
     ICS embebido (SEPTIEMBRE 2025)
     ========================= -->
<script id="ics-data" type="text/plain" style="display:none;">
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Iglesia//Calendario Sept 2025//ES
CALSCALE:GREGORIAN
METHOD:PUBLISH

BEGIN:VEVENT
UID:20250902T190000-SEC3@iglesia
DTSTAMP:20250801T120000Z
DTSTART:20250902T190000
DTEND:20250902T203000
SUMMARY:Culto Evangelístico — Sección III, Sector Florida-Calzada
LOCATION:Sector Florida-Calzada, Maunabo, PR
END:VEVENT

BEGIN:VEVENT
UID:20250903T190000-SEC2@iglesia
DTSTAMP:20250801T120000Z
DTSTART:20250903T190000
DTEND:20250903T203000
SUMMARY:Culto Evangelístico — Sección III, Sector Las Lajas-Matuyas
LOCATION:Sector Las Lajas-Matuyas, Maunabo, PR
END:VEVENT

BEGIN:VEVENT
UID:20250909T190000-CALIMANO@iglesia
DTSTAMP:20250801T120000Z
DTSTART:20250909T190000
DTEND:20250909T203000
SUMMARY:Culto Evangelístico — Parque Pasivo de Calimano
LOCATION:Parque Pasivo de Calimano, Maunabo, PR
END:VEVENT

BEGIN:VEVENT
UID:20250910T190000-CALIMANO@iglesia
DTSTAMP:20250801T120000Z
DTSTART:20250910T190000
DTEND:20250910T203000
SUMMARY:Culto Evangelístico — Parque Pasivo de Calimano
LOCATION:Parque Pasivo de Calimano, Maunabo, PR
END:VEVENT

BEGIN:VEVENT
UID:20250916T190000-EGIDA@iglesia
DTSTAMP:20250801T120000Z
DTSTART:20250916T190000
DTEND:20250916T203000
SUMMARY:Culto Evangelístico — Sección II (al lado de la Égida, Emajagua)
LOCATION:Égida de Emajagua, Maunabo, PR
END:VEVENT

BEGIN:VEVENT
UID:20250917T190000-MALOJA@iglesia
DTSTAMP:20250801T120000Z
DTSTART:20250917T190000
DTEND:20250917T203000
SUMMARY:Culto Evangelístico — Maloja (Emajagua)
LOCATION:Maloja, Emajagua, Maunabo, PR
END:VEVENT

BEGIN:VEVENT
UID:20250923T190000-SEC3@iglesia
DTSTAMP:20250801T120000Z
DTSTART:20250923T190000
DTEND:20250923T203000
SUMMARY:Culto Evangelístico — Sección III
LOCATION:Maunabo, PR
END:VEVENT

BEGIN:VEVENT
UID:20250924T190000-SEC2@iglesia
DTSTAMP:20250801T120000Z
DTSTART:20250924T190000
DTEND:20250924T203000
SUMMARY:Culto Evangelístico — Sección II
LOCATION:Maunabo, PR
END:VEVENT

BEGIN:VEVENT
UID:20250930T190000-CRISTAL@iglesia
DTSTAMP:20250801T120000Z
DTSTART:20250930T190000
DTEND:20250930T203000
SUMMARY:Culto Evangelístico — Sección I (Cristal)
LOCATION:Cristal, Maunabo, PR
END:VEVENT

END:VCALENDAR
</script>

<!-- ===== Etiquetas dinámicas Mar/Mié — Semana con DOMINGO como inicio ===== -->
<script>
(function(){
  const tz = "America/Puerto_Rico";
  const now = new Date();
  const pr = new Date(now.toLocaleString('en-US', { timeZone: tz }));

  // Domingo = inicio
  const dowSun0 = pr.getDay(); // 0=Dom,1=Lun,...6=Sáb
  const sunday = new Date(pr); sunday.setHours(0,0,0,0); sunday.setDate(pr.getDate() - dowSun0);

  const tuesday = new Date(sunday);   tuesday.setDate(sunday.getDate() + 2);
  const wednesday = new Date(sunday); wednesday.setDate(sunday.getDate() + 3);

  const elMartes = document.getElementById('lbl-martes');
  const elMiercoles = document.getElementById('lbl-miercoles');
  if (elMartes)    elMartes.textContent    = `Martes ${tuesday.getDate()}`;
  if (elMiercoles) elMiercoles.textContent = `Miércoles ${wednesday.getDate()}`;
})();
</script>

<!-- === Leer ICS embebido y actualizar títulos + direcciones + mapas (semana desde DOMINGO) === -->
<script>
(function(){
  const TZ = 'America/Puerto_Rico';

  // Utils
  const toPR = d => new Date(d.toLocaleString('en-US',{timeZone:TZ}));
  const startOfDay = d => (d=new Date(d), d.setHours(0,0,0,0), d);
  const addDays = (d,n)=> (d=new Date(d), d.setDate(d.getDate()+n), d);
  const sameDayPR = (a,b)=>{a=toPR(a);b=toPR(b);
    return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()};
  // ISO date formatter
  const toISO = d => {
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const da = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${da}`;
  };

  // Semana con DOMINGO como inicio
  const now = new Date();
  const prNow = toPR(now);
  const dowSun0 = prNow.getDay(); // 0..6
  const sunday = startOfDay(addDays(prNow, -dowSun0));
  const tuesday = addDays(sunday, 2);
  const wednesday = addDays(sunday, 3);

  // Pins exactos por fecha (YYYY-MM-DD) -> maps.app.goo.gl
  const PIN_LINKS = {
    '2025-09-02': 'https://maps.app.goo.gl/PJ4bF5y8kzK7VtC96?g_st=ipc',
    '2025-09-03': 'https://maps.app.goo.gl/ywk9uNajhMkmKq2Y7?g_st=ipc',
    '2025-09-09': 'https://maps.app.goo.gl/Fuv4KNYBiiqfdAEh8?g_st=ipc',
    '2025-09-10': 'https://maps.app.goo.gl/Fuv4KNYBiiqfdAEh8?g_st=ipc',
    '2025-09-16': 'https://maps.app.goo.gl/4L1rut6fFb5x2pKg8?g_st=ipc',
    '2025-09-17': 'https://maps.app.goo.gl/ffA2tEJkTcRMBbib8?g_st=ipc',
    '2025-09-23': 'https://maps.app.goo.gl/FypEuJLpCWbcjvaGA?g_st=ipc',
    // '2025-09-24': (sin pin)
    '2025-09-30': 'https://maps.app.goo.gl/23QLJ7UV3DJJK4uW9?g_st=ipc'
  };
  const tueKey = toISO(tuesday);
  const wedKey = toISO(wednesday);
  const tuePin = PIN_LINKS[tueKey] || null;
  const wedPin = PIN_LINKS[wedKey] || null;

  // Parser ICS
  const unfold = txt => txt.replace(/(?:\r\n|\n)[ \t]/g,'');
  const getLineVal = (block, prop) => {
    const m = block.match(new RegExp('^'+prop+'(?:;[^:\\n]*)?:(.*)$','mi'));
    return m ? m[1].trim() : null;
  };
  function parseDTSTART(block){
    const m = block.match(/^DTSTART([^:\n]*)?:([^\n]+)$/mi);
    if (!m) return null;
    const params = (m[1]||'').toUpperCase();
    const val = m[2].trim();

    const dOnly = val.match(/^(\d{4})(\d{2})(\d{2})$/);
    if (/VALUE=DATE/.test(params) && dOnly){
      const [_,Y,M,D] = dOnly; return new Date(Date.UTC(+Y,+M-1,+D,4,0,0)); // all-day -> ~00:00 PR
    }
    const dt = val.match(/^(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2})(Z)?$/);
    if (dt){
      const [_,Y,M,D,hh,mm,ss,Z] = dt;
      if (/TZID=AMERICA\/PUERTO_RICO/.test(params))
        return new Date(Date.UTC(+Y,+M-1,+D,+hh+4,+mm,+ss));
      if (Z) return new Date(Date.UTC(+Y,+M-1,+D,+hh,+mm,+ss));
      return new Date(Date.UTC(+Y,+M-1,+D,+hh+4,+mm,+ss));
    }
    if (dOnly){
      const [_,Y,M,D] = dOnly; return new Date(Date.UTC(+Y,+M-1,+D,4,0,0));
    }
    return null;
  }

  // Leer ICS embebido
  const icsEl = document.getElementById('ics-data');
  const raw = icsEl ? icsEl.textContent.trim() : '';
  if (!raw) return;

  const t = unfold(raw);
  const blocks = t.split(/BEGIN:VEVENT/).slice(1).map(b=>'BEGIN:VEVENT'+b.split('END:VEVENT')[0]);

  let tueEv=null, wedEv=null;
  for (const ev of blocks){
    const dt = parseDTSTART(ev); if (!dt) continue;
    if (!tueEv && sameDayPR(dt,tuesday))   tueEv = {summary:getLineVal(ev,'SUMMARY'), location:getLineVal(ev,'LOCATION')};
    if (!wedEv && sameDayPR(dt,wednesday)) wedEv = {summary:getLineVal(ev,'SUMMARY'), location:getLineVal(ev,'LOCATION')};
    if (tueEv && wedEv) break;
  }

  // Títulos y direcciones
  const tTitle = document.getElementById('title-martes');
  const wTitle = document.getElementById('title-miercoles');
  const tAddr  = document.getElementById('addr-martes');
  const wAddr  = document.getElementById('addr-miercoles');

  if (tTitle && tueEv?.summary) tTitle.textContent = tueEv.summary;
  if (wTitle && wedEv?.summary) wTitle.textContent = wedEv.summary;
  if (tAddr  && tueEv?.location) tAddr.textContent = tueEv.location;
  if (wAddr  && wedEv?.location) wAddr.textContent = wedEv.location;

  // Mapas (normalizar LOCATION para evitar saltos a lugares erróneos)
  const tueIframe = document.querySelector('#ubicacion-cultos .grid.cols-2 > div:nth-child(1) iframe');
  const wedIframe = document.querySelector('#ubicacion-cultos .grid.cols-2 > div:nth-child(2) iframe');

  // Normaliza una ubicación para que Google Maps no se confunda
  function normalizeLocation(raw){
    if (!raw) return 'Maunabo, Puerto Rico';

    // Toma la parte más “lugar” si viene con guiones o slash
    let txt = String(raw).split(/[-–—/|]/).pop().trim();

    // Limpia paréntesis y espacios duplicados
    txt = txt.replace(/\s*\(.*?\)\s*/g,' ').replace(/\s{2,}/g,' ').trim();

    // Municipios cercanos conocidos
    const municipios = ['Maunabo','Emajagua','Yabucoa','Humacao','Las Piedras','Patillas','Guayama','San Lorenzo'];
    const hasMunicipio = municipios.some(m => new RegExp(`\\b${m}\\b`,`i`).test(txt));

    if (hasMunicipio) {
      // Asegura “Puerto Rico”
      if (!/puerto\s*rico/i.test(txt)) txt += ', Puerto Rico';
      return txt;
    }

    // Si no menciona municipio, ata por defecto a Maunabo, Puerto Rico
    return `${txt}, Maunabo, Puerto Rico`;
  }

  function setMap(iframeEl, locationText, pinUrl) {
    if (!iframeEl) return;
    const query = normalizeLocation(locationText);

    // Establece el mapa embebido usando la misma query normalizada
    iframeEl.src   = 'https://www.google.com/maps?output=embed&q=' + encodeURIComponent(query);
    iframeEl.title = 'Mapa: ' + query;

    // Overlay clickeable para abrir Google Maps en nueva pestaña con la MISMA query
    let overlay = iframeEl.parentElement.querySelector('.map-overlay');
    if (!overlay) {
      overlay = document.createElement('a');
      overlay.className = 'map-overlay';
      overlay.target = '_blank';
      overlay.rel = 'noopener';
      overlay.style.cssText = 'position:absolute;inset:0;z-index:5;';
      const holder = iframeEl.parentElement;
      const cs = getComputedStyle(holder);
      if (cs.position === 'static') holder.style.position = 'relative';
      holder.appendChild(overlay);
    }
    overlay.href = pinUrl || ('https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(query));
  }

  setMap(tueIframe, tueEv?.location, tuePin);
  setMap(wedIframe, wedEv?.location, wedPin);
})();
</script>

<script>
// ===== Detectar si el canal está EN VIVO y mostrar reproductor debajo del botón de YouTube =====
(function(){
  // Configura tu canal
  const CHANNEL_HANDLE = '@pipjm9752';
  // Si conoces el CHANNEL_ID (UCxxxxxxxx...), colócalo aquí para poder embeber el player directamente
  const CHANNEL_ID = ''; // <-- si lo añades, verás el reproductor dentro de la página

  const liveBox = document.getElementById('live-wrap');
  const livePlayer = document.getElementById('live-player');
  const liveCta = document.getElementById('live-cta');
  if (!liveBox) return;

  const liveUrl = `https://www.youtube.com/${CHANNEL_HANDLE}/live`;
  if (liveCta) liveCta.href = liveUrl;

  // Truco sin API: oEmbed devuelve 200 si hay directo, 404 si no.
  const oembed = `https://www.youtube.com/oembed?url=${encodeURIComponent(liveUrl)}&format=json`;

  fetch(oembed, { mode: 'cors' })
    .then(r => {
      if (!r.ok) throw new Error('offline');
      return r.json();
    })
    .then(() => {
      // EN VIVO
      liveBox.style.display = 'block';
      // Si tenemos CHANNEL_ID, insertamos el reproductor incrustado. Si no, dejamos el CTA.
      if (CHANNEL_ID) {
        const src = `https://www.youtube.com/embed/live_stream?channel=${encodeURIComponent(CHANNEL_ID)}&autoplay=1&mute=1&rel=0&modestbranding=1`;
        livePlayer.innerHTML = `<iframe src="${src}" title="YouTube live" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>`;
      } else {
        // Sin CHANNEL_ID: mostramos un mini aviso y dejamos el botón "Ver en YouTube"
        livePlayer.innerHTML = '';
      }
    })
    .catch(() => {
      // OFFLINE: no mostramos nada
      liveBox.style.display = 'none';
    });
})();
</script>
<!-- ===== Botones de suscripción (iCloud/Google) ===== -->
<script>
  const ICLOUD_WEBCAL = "webcal://p158-caldav.icloud.com/published/2/MTYyMzg4NDUwMjAxNjIzOFc_RCw-iCOSeM_LMqkWZcQMuX9sTzZF-PyrU9d06Oy4V0VhxUSZVqCmqzUsygyCHgAllfl2DFW34WcFi8EvPD8";
  const ICLOUD_HTTPS  = "https://p158-caldav.icloud.com/published/2/MTYyMzg4NDUwMjAxNjIzOFc_RCw-iCOSeM_LMqkWZcQMuX9sTzZF-PyrU9d06Oy4V0VhxUSZVqCmqzUsygyCHgAllfl2DFW34WcFi8EvPD8.ics";
  const GCAL_CALENDAR_ID = "72086005a3ac9a324642e6977fb8f296d531c3520b03c6cf342495ed215e0186@group.calendar.google.com";

  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
  const isAndroid = /Android/i.test(navigator.userAgent);
  const gcalAddUrl = "https://calendar.google.com/calendar/r?cid=" + encodeURIComponent(ICLOUD_HTTPS);
  const gcalByIdUrl = "https://calendar.google.com/calendar/u/0?cid=" + encodeURIComponent(GCAL_CALENDAR_ID);
  const playStoreUrl = "https://play.google.com/store/apps/details?id=com.google.android.calendar";
  const appStoreUrl  = "https://apps.apple.com/app/google-calendar/id909319292";

  document.getElementById("btn-ios").addEventListener("click", (e)=>{
    e.preventDefault();
    const url = ICLOUD_WEBCAL;
    if (window.self !== window.top && isIOS) window.top.location.href = url; else window.location.href = url;
    setTimeout(()=>alert("Si no se abrió el Calendario, copia este enlace y ábrelo en Safari:\n" + url), 1600);
  });

  document.getElementById("btn-gcal").addEventListener("click", (e)=>{
    e.preventDefault();

    if (isAndroid){
      // Intenta abrir la app de Google Calendar con intent; si no existe, Play Store
      const intentUrl =
        "intent://calendar/r?cid=" + encodeURIComponent(ICLOUD_HTTPS) +
        "#Intent;scheme=https;package=com.google.android.calendar;" +
        "S.browser_fallback_url=" + encodeURIComponent(playStoreUrl) + ";end";
      window.location.href = intentUrl;
      return;
    }

    if (isIOS){
      // Intenta abrir la app con el esquema; si no está instalada, App Store
      const appScheme = "comgooglecalendar://";
      let didOpen = false;
      const timer = setTimeout(() => {
        if (!didOpen) {
          if (window.self !== window.top) window.top.location.href = appStoreUrl; else window.location.href = appStoreUrl;
        }
      }, 1200);
      const blurHandler = () => { didOpen = true; clearTimeout(timer); window.removeEventListener('blur', blurHandler); };
      window.addEventListener('blur', blurHandler, { once:true });
      // Dispara el esquema; si no cambia el foco, cae al timeout
      if (window.self !== window.top) window.top.location.href = appScheme; else window.location.href = appScheme;
      return;
    }

    // Fallback para otros dispositivos: flujo web de añadir calendario
    const target = gcalAddUrl; // o gcalByIdUrl si prefieres el ID
    if (window.self !== window.top) window.top.location.href = target; else window.location.href = target;
  });

  // Nav activo al hacer scroll (cosmético)
  const links = [...document.querySelectorAll('.navlink')];
  const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);
  const obs = new IntersectionObserver((entries)=>{
    entries.forEach(en=>{
      const i = sections.indexOf(en.target);
      if (i>=0){
        const a = links[i];
        if (en.isIntersecting) { links.forEach(x=>x.classList.remove('active')); a.classList.add('active'); }
      }
    });
  }, { rootMargin: "-50% 0px -40% 0px", threshold: 0.01 });
  sections.forEach(s=>obs.observe(s));
</script>

  <script>
    const openBtn = document.getElementById('open-contact-options');
    const modal   = document.getElementById('contact-modal');
    const closeBtn= document.getElementById('close-modal');

    if(openBtn && modal){
      openBtn.addEventListener('click', e=>{
        e.preventDefault();
        modal.style.display = 'flex';
      });
    }
    if(closeBtn){
      closeBtn.addEventListener('click', ()=> modal.style.display='none');
    }
    window.addEventListener('click', e=>{
      if(e.target === modal) modal.style.display='none';
    });
  </script>
  <script>
  // Oculta el header al bajar y lo muestra al subir (sin tocar el layout)
  (function(){
    const header = document.querySelector('header');
    if (!header) return;

    let lastY = window.scrollY || 0;
    let downAccum = 0, upAccum = 0;
    const THRESH = 12;      // píxeles de histéresis para evitar parpadeos
    const MIN_TOP = 24;     // no ocultar si estamos pegados al tope

    window.addEventListener('scroll', () => {
      const y = window.scrollY || 0;
      const delta = y - lastY;

      if (delta > 0){
        // Bajando
        downAccum += delta; upAccum = 0;
        if (y > MIN_TOP && downAccum > THRESH){
          header.classList.add('hide');
        }
      } else if (delta < 0){
        // Subiendo
        upAccum += -delta; downAccum = 0;
        if (upAccum > THRESH){
          header.classList.remove('hide');
        }
        if (y <= 0){
          header.classList.remove('hide');
        }
      }

      lastY = y;
    }, { passive: true });
  })();
  </script>
</body>
<script>
    window.addEventListener("load", () => {
      document.documentElement.classList.add("loading");
      const loader = document.getElementById("loader");
      const canvas = document.getElementById("explosion-canvas");
      const ctx = canvas ? canvas.getContext("2d") : null;
      const DPR = Math.max(1, Math.floor(window.devicePixelRatio || 1));
      let W = 0, H = 0;

      function resize(){
        if (!canvas) return;
        W = canvas.clientWidth = loader.clientWidth;
        H = canvas.clientHeight = loader.clientHeight;
        canvas.width  = W * DPR;
        canvas.height = H * DPR;
        if (ctx) ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      }
      resize();
      window.addEventListener("resize", resize);

      // Partículas para explosión de fuego (estilo fuegos artificiales cálidos)
      const particles = [];
      const DURATION = 1900; // explosión un poco más larga para cubrir más pantalla
      const START = performance.now();

      function spawnExplosion(){
        // Calcular el centro del logo como origen de la explosión
        const logo = document.querySelector('#loader .logo');
        let cx = W / 2, cy = H / 2;
        if (logo) {
          const rect = logo.getBoundingClientRect();
          const loaderRect = loader.getBoundingClientRect();
          cx = (rect.left - loaderRect.left) + rect.width / 2;
          cy = (rect.top  - loaderRect.top ) + rect.height / 2;
        }
        const N = 800; // MUCHAS partículas para abarcar más pantalla
        for (let i = 0; i < N; i++){
          const angle = (Math.PI * 2) * (i / N) + (Math.random() * 0.2);
          const speed = 3.8 + Math.random() * 6.2; // más rápida para abrir más
          const life  = 1000 + Math.random() * 800; // un poco más de vida
          const size  = 5 + Math.random() * 9;      // chispas más grandes

          // Paleta cálida: blanco -> amarillo -> naranja -> rojo
          const hue = 30 + Math.random() * 30; // 30..60 (amarillo-naranja)
          const sat = 90 + Math.random() * 10;
          const lig = 55 + Math.random() * 30;
          const color = `hsl(${hue} ${sat}% ${lig}%)`;

          particles.push({
            x: cx,
            y: cy,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            alpha: 1,
            size,
            born: START,
            life,
            color
          });
        }
      }

      function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

      function tick(now){
        if (!ctx) return;
        const elapsed = now - START;

        // Fondeo: limpiar con un poco de transparencia para rastro suave
        ctx.globalCompositeOperation = "source-over";
        ctx.clearRect(0, 0, W, H);

        // Encender modo aditivo para brillo de fuego
        ctx.globalCompositeOperation = "lighter";

        for (const p of particles){
          const t = Math.min(1, (now - p.born) / p.life);
          // expansión con ease
          const k = easeOutCubic(t);
          const drag = 0.98;
          p.vx *= drag;
          p.vy *= drag;
          p.x += p.vx * (1.0 + k);
          p.y += p.vy * (1.0 + k);

          // gravedad ligera para sensación de chispas cayendo
          p.vy += 0.015;

          p.alpha = 1 - t;

          ctx.globalAlpha = Math.max(0, p.alpha);
          const grd = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size * (1 + 9*k));
          grd.addColorStop(0, p.color);
          grd.addColorStop(0.6, p.color);
          grd.addColorStop(1, "rgba(0,0,0,0)");

          ctx.fillStyle = grd;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size * (1 + 9*k), 0, Math.PI * 2);
          ctx.fill();
        }

        // Terminar animación tras DURATION
        if (elapsed < DURATION){
          requestAnimationFrame(tick);
        }
      }

      if (ctx) {
        spawnExplosion();
        requestAnimationFrame(tick);
      }

      // Ocultar loader poco después de la explosión
      setTimeout(() => {
        loader.classList.add("hidden");
        document.documentElement.classList.remove("loading");
      }, 2100);
    });
  </script>
</html>